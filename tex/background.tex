\documentclass[12pt]{article}

\usepackage[T1]{fontenc}

\usepackage{aas_macros}
\usepackage[letterpaper, top=1in]{geometry}
\usepackage{titlesec}

\titleformat{\chapter}{\normalfont\normalsize\centering}{\thechapter.}{1em}{}
\titleformat{\section}{\normalfont\normalsize\centering}{\thesection}{1em}{}
\titleformat{\subsection}{\normalfont\normalsize\centering}{\thesubsection}{1em}{}

\usepackage{booktabs}
\usepackage{amsmath}	% Advanced maths commands
\usepackage{txfonts}
\usepackage{hyperref}
\hypersetup{colorlinks=true, linkcolor=blue,filecolor=blue,
citecolor=blue, urlcolor=blue}
\urlstyle{same}
% \usepackage{amssymb}	% Extra maths symbols

\usepackage{graphicx}	% Including figure files
\usepackage{natbib}
\usepackage[nottoc,numbib]{tocbibind}
\usepackage{graphicx}

\title{A (partially-implemented) hydrodynamics code}
\date{\today}
\author{Daniel Boyea}

\graphicspath{{../}}



\begin{document}
   \begin{center}
       {\bf A (partially implemented) hydrodynamics code}\\
       \vspace*{3\baselineskip}
       {Daniel Boyea}\\
       \vspace*{\baselineskip}
       Physics 6810\\
       \vspace*{\baselineskip}
       April 2023\\
       \vspace*{\baselineskip}
       Professor. Bundschuh
       \vspace*{3\baselineskip}
   \end{center}


\section{Overivew}
Here, I describe some of the structure of the code here, and since the program is heavy on the equations, I also note the critical equations. 
See the README.md file for a description of how to excecute the program. 

A note about Julia (since I am not sure how much you have used/seen the language). Julia uses unicode (as a language feature even), so the source code does use unicode symbols for variables (like $\rho$, $\phi$, etc.). Also, Julia is compiled at runtime so there is no need to worry about makefiles. Julia also has some very abbreviated synatx for arithmatic (like \verb|2x^2|) and vectorization (just add a .).

\section{Structure}
The main body of the code is in the \texttt{src/} directory. This directory includes the files
\begin{itemize}
    \item \texttt{GalaxySim.jl}. This just imports and exports other pieces of the project.
    \item \texttt{evolve.jl} contains the main loop of the simulation, including the leapfrog integration scheme and time-step criteria
    \item \verb|gal_files.jl| writes the simulation outputs to files. (Unfortunantly, other io to files for testing are scattered through the project)
    \item \texttt{density.jl} contains routines for density estimation.
    \item \texttt{gravity.jl} calculates the gravity
    \item \texttt{physics.jl} all the rest of the physics (hydrodynaics, viscosity, etc.)
    \item \texttt{particles.jl} definition of the Particle struct
    \item \texttt{params.jl} struct to read in Params (stored in \texttt{init/} directory)
    \item \texttt{constants.jl} Physical constants in cgs (which the code uses internally)
\end{itemize}


\section{Physics}
The hydrodynamic equations using lagrangian derivatives are
\begin{align}
    \nabla \rho = ?
\end{align}

Smoothed Particle Hydrodynamics (SPH) is a varient of the Lagrangian method for solving
hydrodynamics equations. Instead of dividing space up into a grid, each particle is followed and the physical properties are calculated in the frame of each particle.

First, we need a way to estimate the density at any given point from the distribution of nearby points. We do this using a weighted sum over the nearby points of a particle. The density of particle j is
\begin{equation}
    \rho_j = \sum_{i} m_i W(r_{i,j}, h_j),
\end{equation}
where the sum index $i$ is over all points and $W(r, h)$ is the kernel weight at a distance $r$ with a smoothing length $h$. 


\section{Implementation}
I follow a variety of sources to use standard smoothed particle hydrodynamics (SPH) to implement the physics \citep{monaghan92,monaghan05,PM07,phantom,dwarf,price12,gadget}.
The idea (as you probably know) is to estimate the density with a kernel
The kernel also has a smoothing length $h$, which should represent the mass inside the smoothing sphere, i.e.
\begin{equation} \label{eq:h}
    h = \eta\left(\frac{m}{\rho}\right)^{1/3}
\end{equation}
where $\eta$ is  density parameter. This system can be solved using Newton-Raphsons method. I follow \citet{monaghan05} and use the function 
\begin{equation}
    f(h) = \rho - \rho_{\rm new}
\end{equation}
where $\rho$ is calculated from the current value of h in Eq. \ref{eq:h}, and $\rho_{\rm new}$ is calculated from the summation above.

So each new $h$ is found with
\begin{equation}
    h_{\rm new} = h - \frac{f(h)}{f'(h)}
\end{equation}


Other physics (like the change in density, position, etc.) are the standard SPH equations \citep{monaghan05, monaghan92}, except gravity is done following SPH using a smoothed kernel as described in \citet{PM07}.

Integration is leapfrog, so 
\begin{itemize}
    \item $x \to x + v~dt/2$
    \item $v \to v + a~dt/2$
    \item calculate $a$ from current half-step $v$ and $x$
    \item $v \to v + a~dt/2$
    \item $x \to x + v~dt/2$
\end{itemize}



\newpage
\bibliographystyle{aasjournal}
\bibliography{background}

\end{document}
